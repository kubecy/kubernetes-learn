# Pod

## 1.Pod概念

- Pod是Kubernetes中能够创建和部署的最小单元，是Kubernetes集群中的一个应用实例，总是部署在同一个节点Node上。在设计上，仅应该将具有“超亲密”关系的应用分别以不同容器的形式运行于同一Pod内部。

- Pod本质上是共享Network、IPC和UTS名称空间以及存储资源的容器集

  1. 各容器共享网络协议栈、网络设备、路由、IP地址和端口等，但Mount、PID和USER仍隔离。

  2. 每个Pod上还可附加一个“存储卷（Volume）”作为该“主机”的外部存储，独立于Pod的生命周期，可由Pod内的

     各容器共享。

- Pod的生命周期是短暂的，不会自愈，是用完就销毁的实体。一般我们是通过Controller来创建和管理pod。

- 实际上一个 Pod 至少要有包含两个容器，一个是应用容器，一个是 pause 容器。

![image-20240822213415854](./000.picture/image-20240822213415854.png)

> - 对于 Pod 里的容器 A 和容器 B 来说：
>   1. 它们可以直接使用 localhost 进行通信；
>   2. 它们看到的网络设备跟 Infra 容器看到的完全一样；
>   3. 一个 Pod 只有一个 IP 地址，也就是这个 Pod 的 Network Namespace 对应的 IP地址；
>   4. 其他的所有网络资源，都是一个 Pod 一份，并且被该 Pod 中的所有容器共享；
>   5. Pod 的生命周期只跟 Infra 容器一致，而与容器 A 和 B 无关。

### 1.1.pause容器:bell:

- Pause 容器，又叫 Infra 容器，是pod的基础容器，镜像体积只有几百KB 左右，配置在kubelet中，主要的功能是一个pod中多个容器的网络通信。
- Infra 容器被创建后会初始化 Network Namespace，之后其它容器就可以加入到 Infra 容器中共享Infra 容器的网络了，因此如果一个 Pod 中的两个容器 A 和 B，那么关系如下 ：
  1. A容器和B容器能够直接使用 localhost 通信。
  2. A容器和B容器可以可以看到网卡、IP与端口监听信息。
  3. Pod 只有一个 IP 地址，也就是该 Pod 的 Network，Namespace 对应的 IP 地址(由Infra 容器初始化并创建)。
  4. k8s环境中的每个Pod有一个独立的IP地址(前提是地址足够用)，并且此IP被当前 Pod 中所有容器在内部共享使用。
  5. pod删除后Infra 容器随机被删除,其IP被回收。
- Pause容器的好处：
  1. 网络命名空间隔离：Pod是Kubernetes中最小的调度单元，可以包含一个或多个容器。为了实现容器之间的网络隔离，每个Pod都有自己独立的网络命名空间。Pause容器负责创建并维护这个网络命名空间，其他容器共享这个网络命名空间，使它们能够相互通信，而不会与其他Pod中的容器发生冲突。
  2. 进程隔离：Pause容器保持一个轻量级的进程运行，即使Pod中的其他容器都停止了。这个进程实际上不执行任何有用的工作，但它的存在确保了Pod不会在没有容器运行的情况下被删除。当其他容器停止时，Pause容器仍在运行，以维持Pod的生命周期。
  3. 资源隔离：尽管Pause容器通常不分配大量的CPU和内存资源，但它可以配置以使用一些资源。这有助于确保即使Pod中没有其他容器运行时，Kubernetes仍然可以监控和管理Pod的资源使用情况。这也有助于防止Pod被其他具有相同资源要求的Pod占用。
  4. IP地址维护：Pause容器负责维护Pod的IP地址。Pod的IP地址通常是动态分配的，但由于Pause容器一直在运行，它可以维护Pod的IP地址，以便其他容器可以通过该地址进行通信。这有助于确保Pod的IP地址在整个Pod的生命周期内保持一致。
  5. 生命周期管理：Pause容器的生命周期与Pod的生命周期相同。当Pod创建时，Pause容器被创建；当Pod删除时，Pause容器也会被删除。这确保了Pod的整个生命周期都由Kubernetes进行管理，包括创建、扩展、缩放和删除。

## 2.Pod的优势:bell:

- Pod做为一个可以独立运行的服务单元，简化了应用部署的难度，以更高的抽象层次为应用部署管提供了极大的方便。
- Pod做为最小的应用实例可以独立运行，因此可以方便的进行部署、水平扩展和收缩、方便进行调度管理与资源的分配。
- Pod中的容器共享相同的数据和网络地址空间，Pod之间也进行了统一的资源管理与分配。





